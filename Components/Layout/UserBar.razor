@inject NavigationManager Navigation
@inject FrontendBlazorApi.Servicios.ServicioAutenticacion servicioAuth
@rendermode InteractiveServer

<div class="d-flex align-items-center gap-2">

    <!-- Usuario actual -->
    <span class="text-muted">
        <i class="bi bi-person-circle me-1"></i>
        @usuarioEmail
    </span>

    @if (string.IsNullOrWhiteSpace(usuarioEmail) || usuarioEmail == "Invitado")
    {
        <!-- SI NO HAY SESIÓN -->
        <a href="/" class="btn btn-primary btn-sm">
            <i class="bi bi-box-arrow-in-right me-1"></i>
            Iniciar Sesión
        </a>
    }
    else
    {
        <!-- SI HAY SESIÓN -->
        <button class="btn btn-danger btn-sm" @onclick="CerrarSesion">
            <i class="bi bi-box-arrow-right me-1"></i>
            Cerrar Sesión
        </button>
    }
</div>

@code {
    private string usuarioEmail = "Invitado";

    protected override async Task OnInitializedAsync()
    {
        await CargarDatosUsuario();
    }

    private async Task CargarDatosUsuario()
    {
        try
        {
            var email = await servicioAuth.ObtenerEmailUsuarioAsync();

            if (!string.IsNullOrWhiteSpace(email))
                usuarioEmail = email;
        }
        catch
        {
            usuarioEmail = "Invitado";
        }
    }

    private async Task CerrarSesion()
    {
        try
        {
            await servicioAuth.CerrarSesionAsync();
            Navigation.NavigateTo("/", forceLoad: true);
        }
        catch
        {
            Navigation.NavigateTo("/", forceLoad: true);
        }
    }
}